<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
>
  <head>
    <meta charset="UTF-8" />
    <title>Recetas | Recetas Pro</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" />
  </head>
  <body class="bg-light">
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="container mt-5">
      <form method="get" th:action="@{/recetas}" class="d-flex mb-4">
        <input
          type="text"
          name="nombre"
          class="form-control me-2"
          placeholder="Buscar por nombre"
        />
        <button type="submit" class="btn btn-success">Buscar</button>
      </form>

      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <div class="col" th:each="r : ${recetas}">
          <div
            class="card h-100"
            sec:authorize="isAuthenticated()"
            th:onclick="'window.location.href=\'/recetas/' + ${r.id} + '\';'"
            style="cursor: pointer"
          >
            <img
              th:src="${r.imagenUrl}"
              class="card-img-top"
              th:alt="${r.nombre}"
            />
            <div class="card-body d-flex flex-column">
              <h5
                class="card-title d-flex justify-content-between align-items-center"
              >
                <span th:text="${r.nombre}"></span>
                <span th:if="${r.popular}" class="badge bg-danger ms-2"
                  >ðŸ”¥ Popular</span
                >
              </h5>
              <p class="card-text text-muted mb-2">
                <span
                  th:text="${r.tipoCocina} + ' | ' + ${r.paisOrigen}"
                ></span>
              </p>
              <p class="card-text mb-2">
                <strong
                  th:text="'Tiempo: ' + ${r.tiempoPreparacion} + ' min'"
                ></strong>
              </p>
              <p
                class="card-text text-truncate"
                th:text="${r.ingredientes}"
              ></p>
            </div>
          </div>

          <div
            class="card h-100"
            sec:authorize="!isAuthenticated()"
            onclick="mostrarModal();"
            style="cursor: pointer"
          >
            <img
              th:src="${r.imagenUrl}"
              class="card-img-top"
              th:alt="${r.nombre}"
            />
            <div class="card-body d-flex flex-column">
              <h5
                class="card-title d-flex justify-content-between align-items-center"
              >
                <span th:text="${r.nombre}"></span>
                <span th:if="${r.popular}" class="badge bg-danger ms-2"
                  >ðŸ”¥ Popular</span
                >
              </h5>
              <p class="card-text text-muted mb-2">
                <span
                  th:text="${r.tipoCocina} + ' | ' + ${r.paisOrigen}"
                ></span>
              </p>
              <p class="card-text mb-2">
                <strong
                  th:text="'Tiempo: ' + ${r.tiempoPreparacion} + ' min'"
                ></strong>
              </p>
              <p
                class="card-text text-truncate"
                th:text="${r.ingredientes}"
              ></p>
              <span class="badge bg-success" th:if="${r.popular}">Popular</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="loginModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center p-4">
          <p class="mb-3">
            ðŸ”’ Debes iniciar sesiÃ³n para ver los detalles de esta receta.
          </p>
          <button
            class="btn btn-success w-100 mb-2"
            onclick="window.location.href='/login'"
          >
            Iniciar sesiÃ³n
          </button>
          <button
            class="btn btn-outline-secondary w-100"
            data-bs-dismiss="modal"
          >
            Cerrar
          </button>
        </div>
      </div>
    </div>

    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/js/modal.js}"></script>
  </body>
</html>
